Things to do (list is not intended to be complete):

 * handle malloc errors
 * clean-up/improve emulator output
 * make parser reentrant
